<!DOCTYPE html>
<html>

<head>
    <style>
        /* Previous styles remain the same until .card::before */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-size: 1.5rem;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            min-height: 100vh;
            background-image: url('images/bkg.svg');
        }

        .game-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .settings {
            margin-bottom: 20px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 8px;
            display: grid;
            gap: 15px;
        }

        .settings-group {
            display: grid;
            gap: 8px;
        }

        .settings select,
        .settings input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            /* Prevent auto-zoom on iOS */
            margin-top: 4px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: white;
            
            padding: 15px;
            margin-top: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .grid {
            display: grid;
            gap: 2px;
            margin: 0 auto;
            justify-content: center;
            justify-items: center;
        }

        .card {
            background: #2563eb;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
            position: relative;
            touch-action: manipulation;
            /* Disable double-tap zoom */
        }

        /* Pattern styles */
        .card::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background-image: radial-gradient(circle at 5px 5px,
                    #1d4ed8 3px,
                    #2563eb 3px);
            background-size: 20px 20px;
            background-position: center;
            background-repeat: repeat;
        }

        .pattern-stripes::before {
            background-image: repeating-linear-gradient(45deg,
                    #2563eb,
                    #2563eb 10px,
                    #1d4ed8 10px,
                    #1d4ed8 20px);
        }

        .pattern-grid::before {
            background-image:
                linear-gradient(#1d4ed8 2px, transparent 2px),
                linear-gradient(90deg, #1d4ed8 2px, transparent 2px);
            background-size: 20px 20px;
            background-color: #2563eb;
        }

        .pattern-custom::before {
            background-size: cover;
        }

        .card img {
            width: 97%;
            height: auto;
            object-fit: cover;

            display: none;
            position: absolute;
            pointer-events: none;
            /* Prevent image drag on mobile */
        }

        .card.flipped {
            transform: rotateY(180deg);
            background: white;
            border: 2px solid #2563eb;
        }

        .card.flipped::before {
            display: none;
        }

        .card.flipped img {
            display: block;
        }

        .card.matched {
            background: #22c55e;
            border: 2px solid #22c55e;
        }

        .pattern-preview {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin-left: 10px;
            vertical-align: middle;
        }

        button {
            width: 100%;
            margin-top: 20px;
            padding: 12px 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 3rem;
            touch-action: manipulation;
        }

        button:hover {
            background: #1d4ed8;
        }

        #preloader {
            display: none;
        }

        .custom-url-input {
            display: none;
        }

        .custom-url-input.visible {
            display: block;
        }
        .display {
            display: none;
            visibility: hidden;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .game-container {
                padding: 5px;
            }

            .settings {
                padding: 10px;
            }

            .grid {
                gap: 5px;
            }
            .stats {
                font-size: 4rem;
            }
        }

        /* Collapsible settings on mobile */
        .settings-toggle {
            display: none;
            width: 100%;
            padding: 10px;
            background: #e5e7eb;
            border: none;
            border-radius: 4px;
            text-align: left;
            font-size: 16px;
            margin-bottom: 10px;
        }

        @media (max-width: 480px) {
            .settings-toggle {
                display: block;
            }

            .settings {
                display: none;
            }

            .settings.visible {
                display: grid;
            }

            .card {
                font-size: 0.8em;
            }
            .stats {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <button class="settings-toggle" onclick="toggleSettings()">
            ⚙️ Game Settings
        </button>
        <div class="settings" id="settings">
            <div class="settings-group">
                <label for="pairCount">Number of Pairs:</label>
                <select id="pairCount" onchange="resetGame()">
                    <option value="4">4 Pairs</option>
                    <option value="6" selected>6 Pairs</option>
                    <option value="8">8 Pairs</option>
                    <option value="10">10 Pairs</option>
                    <option value="12">12 Pairs</option>
                </select>
            </div>

            <div class="display" class="settings-group">
                <label class="display" for="cardPattern">Card Back Pattern:</label>
                <select class="display" id="cardPattern" onchange="updateCardPattern()">
                    <option value="pattern-stripes">Stripes</option>
                    <option value="pattern-dots">Dots</option>
                    <option value="pattern-chevron">Chevron</option>
                    <option value="pattern-grid">Grid</option>
                    <option value="pattern-custom">Custom Image</option>
                </select>
                <span id="patternPreview" class="display" class="pattern-preview pattern-stripes"></span>
            </div>
            <div id="customUrlInput" class="custom-url-input">
                <label for="cardBack">Custom Image URL:</label>
                <input type="text" id="cardBack" placeholder="Enter image URL" onchange="updateCustomPattern()">
            </div>
        </div>
        <div class="grid" id="grid"></div>
        <div class="stats">
            <div>Moves: <span id="moves">0</span></div>
            <div>Matches: <span id="matches">0</span></div>
        </div>
        <button onclick="resetGame()">New Game</button>

    </div>
    <div id="preloader"></div>
    <script>
        // Previous script remains the same until updateCardBack()
        const imageUrls = [
            'images/unicorn.jpg',
            'images/spider.jpg',
            'images/bird.jpg',
            'images/monkey.jpg',
            'images/fish.jpg',
            'images/elephant.jpg',
            'images/lion.jpg',
            'images/cat.jpg',
            'images/cat2.jpg',
            'images/dog.jpg',
            'images/blue_giraff.jpg',
            'images/blue_gorilla.jpg',
            'images/blue_spider.jpg',
            'images/giraff.jpg',
            'images/gorilla.jpg',
            'images/lemur.jpg',
            'images/otter.jpg',
            'images/rainbow_monkey.jpg',
            'images/red_lion.jpg',
            'images/red_spider.jpg',
            'images/shark.jpg',
            'images/tiger.jpg',
            'images/trex.jpg',
            'images/whale.jpg',
            'images/woodpecker.jpg',
            'images/pteradactyl.jpg'
        ];

        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let preloadedImages = new Set();

        // Rest of the previous functions remain the same
        function preloadImages(urls) {
            const preloader = document.getElementById('preloader');
            preloader.innerHTML = '';

            urls.forEach(url => {
                if (!preloadedImages.has(url)) {
                    const img = new Image();
                    img.src = url;
                    preloader.appendChild(img);
                    preloadedImages.add(url);
                }
            });
        }

        function createCard(imageUrl) {
            const card = document.createElement('div');
            const pattern = document.getElementById('cardPattern').value;
            card.className = `card ${pattern}`;
            card.dataset.image = imageUrl;

            const size = 300;
            card.style.width = `${size}px`;
            card.style.height = `${size}px`;

            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'Card Image';
            card.appendChild(img);

            card.addEventListener('click', flipCard);
            return card;
        }

        // Previous functions remain the same
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getGridSize(pairCount) {
            const totalCards = pairCount * 2;
            if (totalCards <= 12) return 3;
            if (totalCards <= 20) return 4;
            return 5;
        }

        function getRandomImages(imageUrls, pairCount) {
            const result = [];
            const availableImages = [...imageUrls];

            for (let i = 0; i < pairCount; i++) {
                const randomIndex = Math.floor(Math.random() * availableImages.length);
                result.push(availableImages[randomIndex]);
                console.log(availableImages[randomIndex]);
                availableImages.splice(randomIndex, 1); // Remove selected image to avoid duplicates
            }
            console.log(result);
            return result;
        }

        function initializeGame() {
            const pairCount = parseInt(document.getElementById('pairCount').value);
            const gameImages = getRandomImages(imageUrls, pairCount);

            preloadImages(gameImages);

            cards = shuffleArray([...gameImages, ...gameImages]);

            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            const gridSize = getGridSize(pairCount);
            grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

            cards.forEach(imageUrl => {
                const card = createCard(imageUrl);
                grid.appendChild(card);
            });
        }

        function flipCard() {
            if (
                flippedCards.length === 2 ||
                this.classList.contains('flipped') ||
                this.classList.contains('matched')
            ) {
                return;
            }

            this.classList.add('flipped');
            flippedCards.push(this);

            if (flippedCards.length === 2) {
                moves++;
                document.getElementById('moves').textContent = moves;
                checkMatch();
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            if (card1.dataset.image === card2.dataset.image) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                document.getElementById('matches').textContent = matchedPairs;

                const pairCount = parseInt(document.getElementById('pairCount').value);
                if (matchedPairs === pairCount) {
                    setTimeout(() => {
                        alert(`Congratulations! You won in ${moves} moves!`);
                    }, 500);
                }
            } else {
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                }, 1000);
            }
            flippedCards = [];
        }

        function resetGame() {
            moves = 0;
            matchedPairs = 0;
            flippedCards = [];
            document.getElementById('moves').textContent = moves;
            document.getElementById('matches').textContent = matchedPairs;
            initializeGame();
        }

        function toggleSettings() {
            const settings = document.getElementById('settings');
            settings.classList.toggle('visible');
        }

        // Start the game
        initializeGame();
    </script>
</body>

</html>